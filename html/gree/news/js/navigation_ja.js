/*! GreeCommonNavigationJS - v1.2.18 - 2015-04-15 */(function(){if("undefined"==typeof window.gree_common_header){var a=function(){try{window.sessionStorage.setItem("test","dummy"),window.sessionStorage.removeItem("test")}catch(a){return!1}return!0}(),b=a,c=b?window.sessionStorage:!1,d=function(){b&&c.removeItem("navigation_notification")},e=function(){try{window.localStorage.setItem("test","dummy"),window.localStorage.removeItem("test")}catch(a){return!1}return!0}(),f=e,g=f?window.localStorage:!1,h=function(){var a="ontouchstart"in window,b=a?"touchstart":"mousedown",c="touchmove",d=a?"touchend":"mouseup",e="touchcancel",f=["click",b,c,d].join(" ");return{touchable:a,touchStartEvent:b,touchMoveEvent:c,touchEndEvent:d,touchCancelEvent:e,allTouchEvent:f}},i=function(){{var a=this,d={header:{"static":!1,silent:!0},menu:{silent:!0},footer:{disable:!0}},e={header:{"static":!0,silent:!0,hide:{mypage:!0}},menu:{silent:!1},footer:{"static":!1,silent:!1}},h={header:{"static":!0,silent:!1},menu:{silent:!1},footer:{disable:!0}};$("#content")}this.init=function(a){var b,c=void 0===a?{}:a,f=!!c.is_logged_in||void 0!==c.pattern_id,g=m(c.pattern_id),i=this.isHttpsPage();b=f?this.isPositionStyleUnsupported(navigator.userAgent)?h:e:d;var j=q(b.header),k=q(b.footer),l=q(b.menu);void 0!==c.header&&$.extend(j,c.header),void 0!==c.menu&&$.extend(l,c.menu),void 0!==c.footer&&$.extend(k,c.footer),this.isBreakPosition(navigator.userAgent)&&this.fixBreakPosition();var n={is_logged_in:f,is_https_page:i};$.extend(j,n),$.extend(k,n),n.pattern_id=g,$.extend(l,n),gree_common_menu_box.init(l),gree_common_header.init(j),gree_common_footer.init(k)},this.show=function(){gree_common_menu_box.show(),gree_common_header.show(),gree_common_footer.show(),(gree_common_header.show_cntnotifs||gree_common_footer.show_cntnotifs)&&a.countNotifications(a.countNotificationsOnSuccess,a.countNotificationsOnError),(gree_common_footer.show_announce||gree_common_menu_box.show_announce)&&a.showNavigationAnnounces(a.showNavigationAnnouncesOnSuccess,a.showNavigationAnnouncesOnError),a.callScrollTo(),window.addEventListener("hashchange",a.refresh,!1)},this.countNotifications=function(a,d){var e=3e5;if(b&&null!==c.getItem("navigation_notification")&&e>new Date-new Date(JSON.parse(c.getItem("navigation_notification")).updated_at))return void a(JSON.parse(c.getItem("navigation_notification")).data,!0);$.ajaxSettings.beforeSend=function(a){a.withCredentials=!0};var f=$("#greeCommonHeader").data("notification-url");$.ajax({type:"GET",url:f,data:{action:"api_balloon_unreadcount",filter:"navigation"},xhrFields:{withCredentials:!0},cache:!1,dataType:"html",timeout:2e3,success:a,error:d})},this.countNotificationsOnSuccess=function(a,d){d!==!0&&b===!0&&c.setItem("navigation_notification",JSON.stringify({data:a,updated_at:new Date})),gree_common_header.show_cntnotifs&&gree_common_header.updateNotificationCounts(a),gree_common_footer.show_cntnotifs&&gree_common_footer.updateNotificationCounts(a)},this.countNotificationsOnError=function(){},this.showNavigationAnnounces=function(a,b){var c=36e5;if(f&&null!==g.getItem("navigation_announce")&&c>new Date-new Date(JSON.parse(g.getItem("navigation_announce")).updated_at))return void a(JSON.parse(g.getItem("navigation_announce")).data,!0);$.ajaxSettings.beforeSend=function(a){a.withCredentials=!0};var d=$("#greeCommonFooter").data("announce-url"),e=this.getOS(navigator.userAgent);$.ajax({type:"GET",url:d,data:{action:"api_navigation_announce",names:["footer_menu","global_menu"],os:e},xhrFields:{withCredentials:!0},cache:!1,dataType:"html",timeout:2e3,success:a,error:b})},this.showNavigationAnnouncesOnSuccess=function(a,b){b!==!0&&f===!0&&g.setItem("navigation_announce",JSON.stringify({data:a,updated_at:new Date}));var c;try{c=JSON.parse(a)}catch(d){}void 0!==c&&c.result===!0&&(gree_common_footer.show_announce&&null!==gree_common_footer.own()&&gree_common_footer.updateFooterAnnounce(c.footer_menu),gree_common_menu_box.show_announce&&gree_common_menu_box.updateMenuAnnounce(c.global_menu))},this.showNavigationAnnouncesOnError=function(){},this.isPositionStyleUnsupported=function(a){if(!a)return!1;var b=new RegExp(/Android (1\.5|1\.6|2\.1|2\.2)/),c=new RegExp(/iP(?:hone|ad|od); (?:U; )?CPU (?:iPhone )?(like|OS [234]_)/);return!!a.match(b)||!!a.match(c)},this.isScrollNeeded=function(a){if(!a)return!1;var b=new RegExp(/iP(?:hone|ad|od); (?:U; )?CPU (?:iPhone )?OS 5_/);return!!a.match(b)},this.isBreakPosition=function(a){if(!a)return!1;var b=new RegExp(/iP(?:hone|ad|od)/);return!!a.match(b)},this.fixBreakPosition=function(){var a=this;$("input[type=password], input[type=text]").on("focus",function(){$(window).on("orientationchange",a.unfix)}),$("input[type=password], input[type=text]").on("blur",function(){$(window).off("orientationchange",a.unfix),a.fix()})},this.callScrollTo=function(){a.isScrollNeeded(navigator.userAgent)&&setTimeout(function(){$("#content").height()<416&&scrollTo(0,1)},3e3)},this.refresh=function(){void 0!==gree_common_menu_box&&gree_common_menu_box.close(),a.callScrollTo()},this.fix=function(){gree_common_header.fix(),gree_common_footer.fix()},this.unfix=function(){gree_common_header.unfix(),gree_common_footer.unfix()},this.beforeFocus=function(){o(gree_common_header.own("Navigation"),"absolute"),o(gree_common_footer.own(),"absolute")},this.afterFocus=function(){p(gree_common_header.own("Navigation"),"absolute"),p(gree_common_footer.own(),"absolute")},this.showPCLink=function(){gree_common_menu_box.showPCLink()},this.getOS=function(a){if(!a)return"u";var b=new RegExp(/iP(?:hone|ad|od)/),c=new RegExp(/Android/);return a.match(b)?"i":a.match(c)?"a":"o"},this.isHttpsPage=function(){return"https:"===window.location.protocol?!0:!1}};this.gree_common_navigation=new i;var j=function(){};j.prototype={id_prefix:"#greeCommon",template:void 0,init:function(a){var b=void 0===a?{}:a,c=void 0===b.hide?{}:b.hide,d=!!b.is_logged_in;this.pattern_id=b.pattern_id,this.disabled=!!b.disable,this.silent=!d||this.disabled||!!b.silent,this.is_https_page=!!b.is_https_page,this.login_extension=b.login_extension,this.disabled||(this["static"]=!!b["static"],this.show_top=!c.top,this.show_mygame=d&&!c.mygame,this.show_mypage=d&&!c.mypage,this.show_menu=d&&!c.menu,this.show_search=!c.search,this.show_login=!d&&!c.login,this.show_chat=d&&!c.chat,this.show_recommend=!c.recommend,this.show_cntnotifs=!this.silent&&!this.is_https_page,this.show_announce=!this.silent&&!c.announce&&!this.is_https_page,this.is_absolute=!!b.absolute)},observeTap:function(a){a=a?a:".area-tap";var b=100,c="ontouchstart"in window,d=c?"touchstart":"mousedown",e="touchmove",f=c?"touchend":"mouseup",g="touchcancel",h=["click",d,e,f].join(" ");$(a,this.own()).off(h).on(d,function(){var a=$(this);a.data("tapped","true"),setTimeout(function(){"true"===a.data("tapped")&&a.addClass("tapped")},b)}).on(e,function(){var a=$(this);"true"===a.data("tapped")&&$(this).data("tapped","false").removeClass("tapped")}).on(f,function(){$(this).data("tapped","false").removeClass("tapped")}).on(g,function(){$(this).data("tapped","false").removeClass("tapped")}).on("click",function(){var a=$(this);a.addClass("tapped"),setTimeout(function(){a.removeClass("tapped")},b)})},updateNotificationCounts:function(a){if(!this.disabled){var b=a.split(",");b.length>=2&&(this._changeNotificationIcon("Mygame",this._getBadgeValue(b[0])),this._changeNotificationIcon("Mypage",this._getBadgeValue(b[1]))),3===b.length&&this._changeNotificationIcon("Chat",this._getBadgeValueForChat(b[2]))}},_getBadgeValue:function(a){var b=m(a);return 0===b?"":b>99?"99+":b},_getBadgeValueForChat:function(a){var b=m(a);return 0===b?"":"N"},_changeNotificationIcon:function(a,b){var c=this.own("Notification"+a);c.innerHTML=b,""===b?o(c,"hide"):p(c,"hide")},own:function(a){return a=a?a:"",document.getElementById(this.id_prefix+a)},hideContentsArea:function(){var a=document.getElementById("subnavi-container");a&&o(a,"none"),$(".contents-area").addClass("none")},showContentsArea:function(){var a=document.getElementById("subnavi-container");a&&p(a,"none"),$(".contents-area").removeClass("none")},fix:function(){this["static"]||p(this.own(),"static")},unfix:function(){this["static"]||o(this.own(),"static")}};var k=function(){var a=this;this.id_prefix="greeCommonHeader",this.template='<section class="navigation-wrapper" id="greeCommonHeader" data-notification-url="http://notice.gree.net/"><header class="navigation" id="greeCommonHeaderNavigation"><h2 class="logo-gree"><a href="http://games.gree.net/?from_ggpheader=logo_icon" class="area-tap"><div class="sprite logo-image">GREE</div></a></h2><div id="greeCommonHeaderLoginButton" class="login area-tap hide" data-url="http://id.gree.net/?action=login">ログイン</div><ul class="header-menu"><li id="greeCommonHeaderIconMenu" class="hide"><a class="area-tap" id="greeCommonHeaderOpenMenu" href="javascript:void(0)"><div class="inner"><div class="sprite sprite-menu-1_4">メニュー</div></div></a></li><li id="greeCommonHeaderIconSearch" class="hide"><a class="area-tap" id="greeCommonHeaderOpenSearch" href="http://games.gree.net/search?from_ggpheader=search"><div class="inner"><div class="sprite sprite-menu-1_3">検索</div></div></a></li><li id="greeCommonHeaderIconMypage" class="hide"><a id="greeCommonHeaderMypageLink" href="http://gree.net/self/mypage?from_ggpheader=mypage" class="area-tap"><div class="inner"><div class="sprite sprite-menu-1_2">マイページ</div><div class="notification-badge hide" id="greeCommonHeaderNotificationMypage"></div></div></a></li><li id="greeCommonHeaderIconMygame" class="hide"><a href="http://games.gree.net/myapp/list?from_ggpheader=mygame" class="area-tap"><div class="inner"><div class="sprite sprite-menu-1_1">マイゲーム</div><div class="notification-badge hide" id="greeCommonHeaderNotificationMygame"></div></div></a></li></ul></header></section>',this.show=function(){if($("#content").find("section.navigation-wrapper").replaceWith(this.template),this.show_mygame&&p(this.own("IconMygame"),"hide"),this.show_mypage&&p(this.own("IconMypage"),"hide"),this.show_search&&p(this.own("IconSearch"),"hide"),this.show_menu&&(p(this.own("IconMenu"),"hide"),this.own("OpenMenu").addEventListener("click",this.openMenuBox,!1)),this.show_login){var b=this.own("LoginButton");p(b,"hide"),b.addEventListener("click",function(){location.href=a.getLoginUrl()})}this["static"]&&o(this.own("Navigation"),"static"),this.observeTap()},this.openMenuBox=function(){gree_common_menu_box.toggle()},this.getLoginUrl=function(){var a=this.own("LoginButton").getAttribute("data-url");return void 0!==this.login_extension&&(a+=this.login_extension),a}};k.prototype=new j,this.gree_common_header=new k;var l=function(){this.id_prefix="greeCommonFooter",this.template='<nav class="navigation-footer hide" id="greeCommonFooter" data-announce-url="http://gree.net/"><div class="flexible"><div class="icon hide" id="greeCommonFooterIconTop"><a class="area-tap" href="http://games.gree.net/?from_ggpfooter=top"><div class="inner"><span class="sprite interactive24-1_13"></span><div class="text">トップ</div></div></a></div><div class="icon hide" id="greeCommonFooterIconMygame"><a class="area-tap" href="http://games.gree.net/myapp/list?from_ggpfooter=mygame"><div class="inner"><span class="sprite interactive24-1_14"></span><div class="text">マイゲーム</div><div class="notification-badge hide" id="greeCommonFooterNotificationMygame"></div></div></a></div><div class="icon hide" id="greeCommonFooterIconMypage"><a class="area-tap" href="http://gree.net/self/mypage?from_ggpfooter=mypage"><div class="inner"><span class="sprite interactive24-1_15"></span><div class="text">マイページ</div><div class="notification-badge hide" id="greeCommonFooterNotificationMypage"></div></div></a></div><div class="icon hide" id="greeCommonFooterIconChat"><a class="area-tap" id="open-search-menu-bottom" href="http://sns.gree.net/chat#view=chat_list&from_ggpfooter=chat"><div class="inner"><span class="sprite interactive24-1_26"></span><div class="text">チャット</div><div class="notification-badge hide" id="greeCommonFooterNotificationChat"></div></div></a></div><div class="icon hide" id="greeCommonFooterIconRecommend"><a class="area-tap" id="greeCommonFooterOpenRecommend" href="http://games.gree.net/recommend/list?from_ggpfooter=recommend&app_code=GAPRD000003"><div class="inner"><span class="sprite interactive24-1_27"></span><div class="text">イチオシ</div></div></a></div><div class="icon hide" id="greeCommonFooterIconAnnounce"><a class="area-tap" id="greeCommonFooterOpenAnnounce" href=""><div class="inner"><div class="icon32 round" id="greeCommonFooterImageAnnounce"><div class="notification-badge primary_orange xx-small hide" id="greeCommonFooterHotAnnounce">Hot</div><div class="notification-badge primary_blue xx-small hide" style="left: 27px;" id="greeCommonFooterCmAnnounce">CM中</div></div></div></a></div></div></nav>',this.show=function(){var a=$("#content");$("#greeCommonFooter").remove(),a.append(this.template),this.disabled||(a.removeClass("pf").addClass("pf-all"),this.show_top&&p(this.own("IconTop"),"hide"),this.show_mygame&&p(this.own("IconMygame"),"hide"),this.show_mypage&&p(this.own("IconMypage"),"hide"),this.show_chat&&p(this.own("IconChat"),"hide"),this.show_recommend&&p(this.own("IconRecommend"),"hide"),this["static"]&&o(this.own(),"static"),p(this.own(),"hide"),this.observeTap(),this.show_mypage&&$(this.own("IconMypage")).on(h().touchStartEvent,function(){d()}),this.show_mygame&&$(this.own("IconMygame")).on(h().touchStartEvent,function(){d()}))},this.updateFooterAnnounce=function(a){if(void 0!==a&&a.result===!0&&void 0!==a.announces[0]){var b=a.announces[0].image_url,c=a.announces[0].link_url,d=a.announces[0].is_cm,e=a.announces[0].is_hot;this.own("OpenAnnounce").href=c,this.own("ImageAnnounce").style.backgroundImage="url("+b+")",d?p(this.own("CmAnnounce"),"hide"):e&&p(this.own("HotAnnounce"),"hide"),o(this.own("IconRecommend"),"hide"),p(this.own("IconAnnounce"),"hide")}}};l.prototype=new j,this.gree_common_footer=new l,CommonMenuBox=function(){var a=this;this.id_prefix="greeCommonMenu",this.template='<section class="krillin-area hide" id="greeCommonMenu"><section><ul class="krillin-menu"><li class="col"><a href="http://games.gree.net/?from_ggpmenulist=menu_top" class="area-tap"><span class="sprite interactive36-1_1"></span><div class="title">トップ</div></a></li><li class="col"><a href="http://games.gree.net/myapp/list?from_ggpmenulist=menu_mygame" class="area-tap"><span class="sprite interactive36-1_2"></span><div class="title">マイゲーム</div></a></li><li class="col"><a href="http://sns.gree.net/#view=mypage_top&from_ggpmenulist=menu_mypage" class="area-tap"><span class="sprite interactive36-1_3"></span><div class="title">マイページ</div></a></li><li class="col hide" id="greeCommonMenuItemFriend"><a href="http://sns.gree.net/#user_id=user_id&view=friend_list&from_ggpmenulist=default_um_friends" class="area-tap" id="greeCommonMenuLinkFriend"><span class="sprite interactive36-1_4"></span><div class="title">友だち</div></a></li><li class="col"><a href="http://sns.gree.net/#view=community_mycommunity&from_ggpmenulist=default_um_communities" class="area-tap"><span class="sprite interactive36-1_5"></span><div class="title">コミュニティ</div></a></li><li class="col"><a href="http://sns.gree.net/chat#view=chat_list&from_ggpmenulist=chat" class="area-tap"><span class="sprite interactive36-1_16"></span><div class="title">チャット</div></a></li><li class="col"><a href="http://payment.gree.net/?from_ggpmenulist=menu_coins" class="area-tap"><span class="sprite interactive36-1_7"></span><div class="title">GREEコイン</div></a></li><li class="col"><a href="http://sns.gree.net/#view=settings_top&from_ggpmenulist=default_um_settings" class="area-tap"><span class="sprite interactive36-1_8"></span><div class="title">設定</div></a></li><li class="col hide relative" id="greeCommonMenuLiAnnounce"><a href="" class="area-tap" href="" id="greeCommonMenuOpenAnnounce"><div class="icon48 round" id="greeCommonMenuImageAnnounce"><div class="icon_tag tag_hot hide" id="greeCommonMenuHotAnnounce"></div><div class="icon_tag tag_cm hide" id="greeCommonMenuCmAnnounce"></div></div></a></li><li class="col"><a href="http://avatar.gree.net/?from_ggpmenulist=default_um_avatar" class="area-tap"><span class="sprite interactive36-1_9"></span><div class="title">アバター</div></a></li><li class="col"><a href="http://jp.news.gree.net/?from_ggpmenulist=default_um_news" class="area-tap"><span class="sprite interactive36-1_12"></span><div class="title">ニュース</div></a></li><li class="col"><a href="http://sns.gree.net/#view=mail_inbox&from_ggpmenulist=default_um_mail" class="area-tap"><span class="sprite interactive36-1_6"></span><div class="title">メール</div></a></li><li class="col"><a href="http://fortune.gree.net/?from_ggpmenulist=menu_fortune_top" class="area-tap"><span class="sprite interactive36-1_15"></span><div class="title">占い</div></a></li><li class="col"><a href="http://celeb.gree.net/?from_ggpmenulist=menu_celeb" class="area-tap"><span class="sprite interactive36-1_13"></span><div class="title">芸能</div></a></li><li class="col"><a href="http://qa.gree.net/?from_ggpmenulist=default_um_qa" class="area-tap"><span class="sprite interactive36-1_10"></span><div class="title">グリキュー</div></a></li></ul></section><section><div class="separate"></div><div class="list-item hide" id="greeCommonMenuItemPC"><a href="http://gree.jp/?mode=preference&act=set&fepref=pc" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">PC版</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://help.gree.net/?mode=helpcenter" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">ヘルプ</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://help.gree.net/?action=form&from_ggpmenulist=menu_contact" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">お問い合わせ</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://id.gree.net/?action=misc_tos_generic&page=terms&from_ggpmenulist=default_um_terms" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">利用規約</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://id.gree.net/?action=misc_tos_coin&from_ggpmenulist=default_um_tos_coin" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">GREEコイン利用規約</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://id.gree.net/?action=misc_tos_generic&page=contents_guideline&ggpmenulist=default_um_contentsguideline" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">デジタルコンテンツポリシー</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://id.gree.net/?action=misc_tos_generic&page=privacy_policy&ggpmenulist=default_um_privacypolicy" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">プライバシーポリシー</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div><div class="list-item"><a href="http://www.ema.or.jp/evaluation/community/20080828_00012.html" target="_blank" class="area-tap"><div class="flexible"><div class="item-content"><div class="medium bold minor">EMA認定番号&nbsp;1200012(07)</div></div><div class="arrow-area"><div class="sprite other-9_1">&gt;</div></div></div></a></div></section></section>',this.is_opened=!1,this.show=function(){this.is_opened=!1,$("#greeCommonMenu").remove(),$("#content").append(this.template),this.menu_box=this.own(),this.body=document.getElementsByTagName("body")[0],this.container=$("#container"),this.observeTap(),this.closeWithClick(),0!==this.pattern_id&&(this.showFriendLink(),this.fixURL())},this.fixURL=function(){var b=a.own("LinkFriend").href;b=b.replace("user_id=user_id","user_id="+a.pattern_id),a.own("LinkFriend").href=b},this.closeWithClick=function(){$("#greeCommonMenu a").on("click",this.close)},this.open=function(){a.hideContentsArea(),p(a.menu_box,"hide"),a.body.style.cssText="background-color: #f1f2f3 !important;",a.container.css("background-color","#f1f2f3 !important;"),a.is_opened=!0},this.close=function(){a.showContentsArea(),o(a.menu_box,"hide"),a.body.removeAttribute("style"),a.container.css("background-color",""),a.is_opened=!1},this.toggle=function(){a.is_opened?a.close():a.open()},this.showPCLink=function(){p(this.own("ItemPC"),"hide")},this.showFriendLink=function(){p(this.own("ItemFriend"),"hide")},this.updateMenuAnnounce=function(a){if(void 0!==a&&a.result===!0&&void 0!==a.announces[0]){var b=a.announces[0].image_url,c=a.announces[0].link_url,d=a.announces[0].is_cm,e=a.announces[0].is_hot;this.own("OpenAnnounce").href=c,this.own("ImageAnnounce").style.backgroundImage="url("+b+")",d?p(this.own("CmAnnounce"),"hide"):e&&p(this.own("HotAnnounce"),"hide"),p(this.own("LiAnnounce"),"hide")}}},CommonMenuBox.prototype=new j,this.gree_common_menu_box=new CommonMenuBox;var m=function(a){var b=parseInt(a,10);return"number"!=typeof b||isNaN(b)||0>b?0:b},n=function(a,b){if(!a||!a.className)return!1;var c=new RegExp("(\\s|^)"+b+"(\\s|$)");return!!a.className.match(c)},o=function(a,b){n(a,b)||(a.className+=" "+b)},p=function(a,b){if(n(a,b)){var c=new RegExp("(\\s+|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}},q=function(a){var b=function(){};return b.prototype=a,new b}}}).call(this);
